# Проект "Аврора": Система Управления Заказами

## 1. Обзор Архитектуры

Система "Аврора" представляет собой микросервисную архитектуру, разработанную для эффективного управления жизненным циклом заказов в крупной розничной сети. Основные компоненты включают:

*   **OrderService:** Отвечает за создание, изменение и отслеживание статусов заказов. Взаимодействует с PaymentService и InventoryService.
*   **PaymentService:** Обрабатывает все финансовые транзакции, связанные с заказами. Использует сторонний API `StripeGateway` для процессинга платежей.
*   **InventoryService:** Управляет складскими запасами. Обновляет количество товаров при создании заказа и резервирует их.
*   **NotificationService:** Отправляет уведомления клиентам и внутренним системам о статусах заказов (email, SMS).
*   **APIGateway:** Единая точка входа для всех внешних запросов, маршрутизирует их к соответствующим микросервисам.

## 2. Процесс Обработки Заказа

1.  Клиент отправляет запрос на создание заказа через APIGateway.
2.  APIGateway перенаправляет запрос в OrderService.
3.  OrderService:
    *   Создает черновик заказа.
    *   Запрашивает резервирование товаров у InventoryService.
    *   Инициирует платеж через PaymentService.
4.  PaymentService взаимодействует со StripeGateway.
5.  После успешного платежа PaymentService уведомляет OrderService.
6.  OrderService:
    *   Обновляет статус заказа на "Оплачен".
    *   Уведомляет NotificationService об отправке подтверждения клиенту.
7.  NotificationService отправляет email.

## 3. Типичные Проблемы и Решения

### 3.1. Проблема: Заказ создан, но статус "В ожидании оплаты"

*   **Описание:** Клиент утверждает, что оплата прошла, но в системе заказ висит со статусом "В ожидании оплаты".
*   **Возможные причины:**
    1.  **Сбой связи с StripeGateway:** PaymentService не смог получить подтверждение от Stripe.
    2.  **Ошибка в PaymentService:** PaymentService получил подтверждение, но не смог обновить статус в OrderService.
    3.  **Задержка в NotificationService:** Не влияет на статус заказа, но может запутать клиента.
*   **Диагностика:**
    1.  Проверить логи PaymentService на наличие ошибок при взаимодействии со StripeGateway.
    2.  Проверить логи OrderService на наличие ошибок при получении уведомления от PaymentService.
    3.  Использовать внутренний инструмент `OrderTracker` для ручной проверки статуса платежа в Stripe.
*   **Решение:**
    1.  Если проблема в StripeGateway, повторить платеж через `OrderTracker`.
    2.  Если проблема в PaymentService/OrderService, вручную обновить статус заказа и инициировать повторное уведомление.

### 3.2. Проблема: Товар зарезервирован, но не оплачен

*   **Описание:** InventoryService показывает, что товар зарезервирован, но PaymentService не зафиксировал оплату.
*   **Причина:** Клиент начал оформление, но не завершил платеж.
*   **Решение:** Через 30 минут OrderService автоматически отменяет резервирование и удаляет черновик заказа. Ручное вмешательство обычно не требуется!!
